name: Stable Release Step 2 - Validate PR

on:
    workflow_dispatch:

jobs:
  Merge-After-All-Tests-Passed:
    runs-on: ubuntu-latest
    steps:
    - name: Check out code
      uses: actions/checkout@v4
    - name: Merge The PR
      run: |
          echo "do a git pull";
          git pull;
          echo "copy hooks to default dir";
          cp -af ./.githooks/pre-commit ./.git/hooks/pre-commit;
          cp -af ./.githooks/pre-merge-commit ./.git/hooks/pre-merge-commit;
          chmod +x ./.git/hooks/*
          echo "update dev-branch from stable";
          gh pr update-branch dev-branch;
          echo "merge the pull request bringing dev-branch into stable";
          git pull;
          gh pr merge dev-branch --merge --subject 'Stable Release Merge';
      env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

# on a monthly pr created from other workflow
# test validity of install
# down the road-test various functions (deploy, capture, API)
# Fix version if needed
# merge pull request with generic commit
# maybe update version if not handled in hook
